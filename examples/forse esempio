set dimension with 1000
set inputsize with 200
set resources with 128

import "examples/example_code.hpp"

annotate seq_vec_vec with servicetime 9
annotate map_vec_vec with servicetime 7
annotate map_minus with servicetime 24
annotate reduce_vec_double with servicetime 5
annotate dc_dummy with servicetime 7

m = map(map_vec_vec )
mf = map(farm( map_vec_vec ))
optimize mf with twotier
c = comp( m, mf)
dc = divide_conquer( dc_dummy )
cr = comp( map_minus , reduce_vec_double )
rcr = reduce(cr)
main = pipe( c, seq_vec_vec , dc, rcr)

add source_vec in main
add drain_elem in main

show main
show main by servicetime , latency , compltime , pardegree , resources 
show main by servicetime , latency , compltime , pardegree , resources , unrank 
show main by servicetime , latency , compltime , pardegree , resources , unrank, full 
show main by servicetime , compltime , resources , unrank, full 

rewrite c with mapofcomp 
show main by servicetime , compltime , resources , unrank, full 
#potrei mettere sia rew c che rew main con rec

rewrite seq_vec_vec with farmintro 
show main by servicetime , compltime , resources , unrank, full  

optimize main with twotier , subexp 
show main by servicetime , compltime , resources , unrank, full  

#optimize main with mapopt , farmopt , dcopt , reduceopt 
#show main by servicetime , compltime , resources , unrank, full 
#optimize main with mapopt , farmopt , dcopt , reduceopt , subexp 
#show main by servicetime , compltime , resources , unrank, full 
#optimize main with pipeopt 
#show main by servicetime , compltime , resources , unrank, full 
#optimize main with pipeopt , subexp 
#show main by servicetime , compltime , resources , unrank, full 
#optimize main with maxresources 
#show main by servicetime , compltime , resources , unrank, full 
#optimize main with maxresources , subexp 
#show main by servicetime , compltime , resources , unrank, full 
#optimize main with pipeopt , subexp 
#show main by servicetime , compltime , resources , unrank, full 
#show main by servicetime , compltime , resources , full 
#rewrite main with allrules 
#show main by servicetime , compltime , resources , full 
#history
#gencode main[20] as example_code_ff in "examples/"

